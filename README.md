# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитекутрный подход: **MVP** (Model-View-Presenter)

1. Слой данных (**Model**) — данные, в которых отражена вся ценность приложения, содержит значительную часть бизнес-логики, при изменении данных, они попадают в отображение.

2. Слой отображения (**View**) — интерфейс для взаимодействия с пользователем, выводит на экран разметку с данными и генерирует события с действиями пользователя.

3. Слой управления (**Presenter**) слушает события в пользовательском интерфейсе и принимает решение, что с ними делать и в какую модель отнести, чтобы она среагировала и поменялась. Реализован черезEvent Broker, который позволяет компонентам системы взаимодействовать друг с другом через события, не имея прямой зависимости друг от друга, подписываться на события, инициировать их и управлять подписками.

## Описание данных

### Интерфейсы

- `IProduct` соответствует всем данным товара (id, описание, картинка, название, категория, цена, добавлен ли товар в корзину);
- `TProductCard` используется для отображения карточек на главной странице;
- `TProductCart` используется в модальном окне корзины при оформлении заказа;
- `ICatalog` хранит массив карточек, выводимых на главной странице и счетчик товаров в корзине;
- `ICardsData` отвечает за хранение массива карточек и работу с их данными;
- `ICart` будет использоваться при открытии корзины и содержать список товаров и их сумму, работу с отображением данных заказа;
- `IUser` хранит данные пользователя и методы по установке, получению этих данных и валидации формы: тип `TUserOrder` используется на первом этапе оформления заказа и хранит информацию о способе оплаты и адрес доставки, `TUserContacts` используется на втором этапе оформления заказа, при вводе контактных данных (хранит электронную почту и номер телефона пользователя).

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:
- `get` выполняет GET запрос на переданный в параметрах endpoint и возвращает promise с объектом, которым ответил сервер;
- `post` принимает объект с данными, которые будут переданы в JSON в теле запроса и отправляет эти данные на endpoint, переданный как параметр при вызове метода. По умолчанию выполянет POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.\
Класс имеет методы `on`, `off`, `emit` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.\
Дополнительно реализованы методы  `onAll` и  `offAll`  — для подписки на все события и сброса всех
подписчиков.
Метод  `trigger` генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.


### MODEL (СЛОЙ ДАННЫХ)

#### Класс CardsData
Отвечает за хранение и логику работы с данными карточек товаров на главной странице. Конструктор класса принимает инстант брокера событий(`cards:changed` для загрузки массива карточек, `card:select` для передачи id карточки в).\
В полях класса хранятся следующие данные:
- cards: IProduct[] - массив объектов карточек продуктов;
- _preview: string | null - id карточки товара, выбранной для просмотра в модальном окне;
- events: IEvents - экземпляр класса 'EventEmitter' для инициализации событий при изменении данных (получении массива карточек с сервера `cards:changed`).

Методы для взаимодействия с данными:
- setCards(cards: IProduct[]): void - добавляет карточки товаров в каталог при загрузке страницы;
- addToCart?(cardId: string): void / removeFromCard?(cardId: string): void - методы добавляют true/false в поле isInCart объекта карточки, вызывается при нажатии на кнопку "Купить": событии `card:add` или клику по иконке удаления из корзины: событие `card:delete`;
- getCard(cardId: string): IProduct - возвращает карточку по её id (далее инициируется событие `card:selected`);
- getAddedProducts(): IProduct[] - фильтрует массив карточек по наличию `isInCart: true` при открытии корзины: событие `cart:open`;
- getTotalPrice(): number - получает сумму цены всех товаров в корзине;
- resetAdded(): boolean - перезагружает значение поля isInCart после успешной покупки товаров.
- сеттеры и геттеры для получения и хранения данных из полей класса.

#### Класс UserData
Отвечает за хранение и логику работы с данными пользователя. Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- payment: 'online' | 'cash' - выбранный способ оплаты товара;
- address: string - адрес доставки;
- email: string - адрес электронной почты;
- phone: string - номер телефона;
- events: IEvents экземпляр класса 'EventEmitter' для инициализации событий при изменении данных.

Также класс предоставляет набор методов для работы с этими данными:
- getUserInfo(): TUserPayment | TUserOrder, возвращает набор данных пользователя, используемых при оформлении заказа;
- setUserInfo(userData: TUserPayment | TUserOrder): сохраняет данные пользователя в классе;
- checkUserValidation(data: Record<keyof TUserPayment | keyof TUserOrder, string>): boolean - проверяет объект с данными пользователя на валидность;


### VIEW (СЛОЙ ОТОБРАЖЕНИЯ)

#### Класс Card
Отвечает за отображение карточки продукта, задавая в карточке данные: название, категорию, изображение, цену, описание, устанавливается слушатель на нажатие по карточке(событие `card:select`), в конструктор класса передается id блока (blockID: string), DOM-элемент (container: HTMLElement) и экземпляр класса 'EventEmitter' для инициации событий (например `card:selected` для отрисовки карточки в шаблоне модального окна).\
Поля классов содержат элементы разметки карточек:
- _title: HTMLElement;
- _image: HTMLImageElement;
- _category: HTMLElement;
- _price: HTMLElement;
- _button: HTMLButtonElement;
Методы:
- setCardData(cardData: IProduct): void - заполняет атрибуты элементов карточки данными (вызывается при срабатывании события `cards:changed`);
- disableButton(): void; - управление активностью кнопки "Купить";
- render(): HTMLElement - возвращает полностью заполненную карточку с установленными слушателями.

#### Класс Catalog
Отвечает за отображение карточек товаров и иконки корзины на главной странице. В конструктор принимает `container`, в котором размещаются карточки и экземпляр класса 'EventEmitter' для возможности инициации событий. Поля заполняются при помощи сеттеров:
- _counter: HTMLElement;
- _catalog: HTMLElement;

#### Класс Cart 
Отвечает за отображение товаров в корзине, для работы с полями класса используются сеттеры. Конструктор класса кроме id блока (blockID: string) и родительского элемента (container: HTMLElement) принимает инстант брокера событий (вызывается при открытии корзины: событие `cart:open`).\
В полях класса хранятся следующие данные:
- items: string[] | null - список id выбранных товаров (у которых isInCart: true)
- total: number - конечная сумма заказа;
- button: HTMLButtonElement;

Класс содержит следующие методы:
- disableButton(): void; управление активностью кнопки "Оформить";
- refreshSerialNumber(): void - обновляет порядковые номера товаров в корзине при удалении товара;
- clearCart(): void - очистка корзины после успешного заказа.

#### Класс Modal
Реализует отображение модальных окон приложения, содержит методы `open` и `close` для управления поведением всех модальных окон, контент устанавливается с помощью сеттера. Устанавливает слушатели на клавиатуру для закрытия окна по клавише ESC, на клик по оверлею и кнопке закрытия (крестику).\
Поля хранят следующие данные:
- closeButton: HTMLButtonElement - кнопка закрытия модального окна;
- _content: HTMLElement - содержание, которое выводится в разметку модального окна;
- events: IEvents - брокер событий.

Конструктор класса:
- constructor(container: HTMLElement, events: IEvents) принимает в качестве аргумента соответствующий контейнер модального окна и экземпляр класса 'EventEmitter' для возможности инициации событий.

#### Класс Form
Предназначен для реализации формы, содержащей поля ввода. При отправке формы инициализирует событие, передавая в него объект с данными из полей ввода формы. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Поля класса:
- isValid: boolean - поле, хранящее информацию, валидна ли форма;
- error: string - текст ошибки;
- submitButton: HTMLButtonElement - кнопка подтверждения отправки;
- _errors: HTMLElement - элемент, отображающий ошибки валидации.

Конструктор класса:
- constructor (container: HTMLElement, events: IEvents) принимает в качестве аргумента соответствующий контейнер модального окна и экземпляр класса 'EventEmitter' для возможности инициации событий.

Методы класса:
- setButtonState - изменяет активность кнопки подтверждения;
- showError(element: HTMLElement): void / hideError(element: HTMLElement): void  отвечает за отображение ошибок при заполнении формы;
- для установки полей isValid и errors используется сеттер.

#### Класс Order
Описывает окно оформления заказа, поля класса содержат ссылки на кнопки выбора оплаты заказа:
- _card: HTMLButtonElement;
- _cash: HTMLButtonElement;

Конструктор принимает id блока `blockID: string`, родительский элемент `container: HTMLFormElement` и обработчик событий events: IEvents.\
Метод класса отключает подсвечивание кнопок при выборе способа оплаты `disableButtons(): void`.

#### Класс Contacts
Описывает окно контактов, конструктор принимает родительский элемент и обработчик событий (container: HTMLFormElement, events: IEvents);


### СЛОЙ КОММУНИКАЦИИ

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и преоставляет методы, реализующие взаимодействие с бэкендом сервиса.

### Взаимодействие компонентов:
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера. Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, настраиваемых в `index.ts` после создания экземпляров всех необходимых классов.

***Список всех событий, которые могут генерироваться в системе:***\
*События изменения данных (генерируются классами моделей данных):*
- `cards:changed` - массив карточек при загрузке страницы изменен;
- `card:selected` - карточка выбрана для открытия её в модальном окне;
- `card:added` - товар добавлен в корзину;
- `card:deleted` - товара удален из корзины;
- `card:previewClear` - очистка данных выбранной для показа в модальном окне карточки товара.

*События, возникающие при взаимодействии с пользователем (генерируются классами слоя представления):*
- `card:select` - открытие карточки товара;
- `card:add` - добавление товара в корзину;
- `card:delete` - удаление товара из корзины;
- `cart:open` - открытие корзины с товарами;
- `cart:validation` - валидация состава корзины с товарами (проверка, что сумма заказа превышает ноль);
- `order:open` - открытие окна ввода данных пользователя на первом этапе оформления заказа;
- `order:input` - изменение данных в форме с данными пользователя на первом этапе оформления заказа;
- `order:validation` - валидация данных пользователя на первом этапе оформления заказа;
- `order:submit` - отправка данных пользователя на первом этапе оформления заказа;
- `contacts:open` - открытие окна ввода данных пользователя на втором этапе оформления заказа;
- `contacts:input` - изменение данных в форме с данными пользователя на втором этапе оформления заказа;
- `contacts:validation` - валидация данных пользователя на втором этапе оформления заказа;
- `contacts:submit` - отправка данных пользователя на втором этапе оформления заказа;
- `success-window:open` - открытие окна успеха оформления заказа;
- `modal:close` - закрытие модального окна.